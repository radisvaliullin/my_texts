# Просто о Биткоин, блокчейн.

Цель данной статьи максимально просто объяснить что такое Биткойн, блокчейн обывателю плохо представляющему как устроен компьютер, интернет, базы данных, криптография, электронно-цифровая подпись и т.п., без искажения сути и базовой идеи лежащей в основе данной технологии.

Биткойн - это децентрализованная (без единого центра/сервера) электронная платежная система, с внутренней одноименной валютой (биткойн), работающая через интернет. Биткойн как и любая другая платежная система (paypal, yandex money, коммерческие банки и т.п.) позволяет пользователям иметь счета (в биткойн) и совершать переводы между счетами.

В 2008 сообщество Биткойн публикует свой манифест "Bitcoin: A Peer-to-Peer Electronic Cash System" / "Биткойн: электронная денежная система с равноправными участниками" под псевдонимом Сатоши Накомото. Цель проекта предоставить людям электронную валюту и платежную систему работающую минуя существующие финансовые институты (в лице гос-ва, банков, и т.п.).

Что бы было проще давайте сравним биткойн с работой традиционных банков.

Кратко о банках

Центробанк печатает деньги (эмиссия) согласно законам и денежной политике гос-ва. Далее ЦБ кредитует крупные коммерческие банки, те в свою очередь средние и мелкие. Банки кредитуют бизнес и людей. Бизнес и люди осуществляют товаро-денежный обмен. Так же гос-во предоставляет паспорта, уникальный идентификатор гражданина, по которому можно в банке открыть счет и управлять этим счетом. Это упрощенное дилетантское описание, но вполне приемлемое для нас.

Как выше описанные функции решает децентрализованная система Биткойн, а именно:

- как биткойн печатает деньги, без доверенного центра, и как они распределяются по участникам;
- как в биткоине организованны счета людей, при этом что бы информация о пользователе оставалась приватной/анонимной, ни кто не мог по номеру счета узнать владельца счета, его персональные данные, при том что бы владелец мог управлять и контролировать свой счет;
- как переводить деньги между анонимными счетами;
- и самое сложная задача, которую долгое время не удавалось решить, как в децентрализованной сети решить проблему двойной траты (забегая вперед как раз ее и решает блокчейн).

Проблема Двойной траты

Представьте себе что у вас на счету вашего банка есть 100 рублей. Вы заходите с двух телефонов в мобильный банк и с каждого из устройств одновременно делаете покупку на 100 рублей. Создаются две транзакции (платежа) превышающие в сумме баланс на вашем счету. Возникает вопрос а какая из этих операций верная. В централизованной системе все просто, как только два запроса придут на сервера банка (интернет не гарантирует в каком порядке придут эти запросы), банк и решит спорный вопрос, обработает одну из транзакций а вторую отклонит как превышающую ваш баланс, главное что вы не сможете потратить больше чем у вас есть.  

В децентрализованной системе все сложней (вы наверное и так уже догадались). Состояние вашего счета храниться у вас и у всех участников сети (пока опустим каким образом). У вас на счету 100 рублей. Вы создаете два платежа по 100 рублей двум разным участникам, и эти два платежа отправляете (каждый платеж отдельным запросом) всем участникам сети, что бы у всех была актуальная информация. Как уже говорилось интернет не гарантирует в каком порядке эти два запроса придут каждому из участников, и так может случится что половине придет в одном порядке а другой в другом, и тогда возникает вопрос как выбрать первую транзакцию а вторую отклонить. Может случится так что каждому из двух получателей платежа может прийти первым его платеж и они могут отравить товар покупателю, решив что их платеж прошел, произойдет двойная трата, за одни и те же 100 рублей произойдет покупка двух товаров. Даже если получатели запросят подтверждения порядка еще у кого то из участников, нет гарантии что они запросят у участников с другим порядком, только если не запросить у всех, а это слишком накладно и делает сеть мало пригодной. Как оказалось это не тривиальная задача, на решение которой у энтузиастов криптовалют ушло много лет. Но давайте разбираться по порядку.

Эмиссия биткойна.

Цифровые деньги, например те что на счетах ваших банковских карт, это просто записи (байтов) в базе данных на серверах банков. "Печатание" денег это ни что иное как создание записей в базе данных, что такая то сумма "напечатана". Важно отметить что печать денег должно подчинятся определенным правилам иначе такие деньги не будут представлять ценности. Как правило за этим следят центробанки.

Криптовалюта как и обычные цифровые деньги это не более чем записи в базе данных но не на централизованных серверах а на компьютерах участников децентрализованной сети. Так же есть правила регламентирующие объем "печатаемых" биткоинов и их распределение по счетам участников, но в отличие от централизованной модели за соблюдением правил следят все участники системы.

Как это выглядит. В Биткойн сети каждые десять минут создается блок блокчейна (пока не важно что это за блоки), за его создание его создателю (им может быть любой участник) в качестве вознаграждения за обслуживание системы начисляется 12.5 биткоинов, путем их "печатания" и зачисления на счет создателя. Изначально вознаграждение было 50 BTC но через 210 000 блоков вознаграждение уменьшается в двое, что бы общее кол-во биткоинов не превысило 21 млн. Так как общее кол-во биткоинов ограниченно, биткойн это дефляционная валюта.

Счета и переводы (транзакции)

Давайте поговорим теперь как устроенны счета на которые зачисляются эмитированные биткоины и как можно переводить биткоины между счетами участников, оплачивая товары, услуги или просто прикола ради.

Как уже говорилось каждый участник системы имеет у себя полную копию базы биткоина со всеми счетами и транзакциями. Как таким образом скрыть информация о пользователе счета оставляя ему возможность контролировать свой счет. Это решается с помощью технологии называемой электронно цифровая подпись. Давайте немного поговорим о ней.

Электронно цифровая подпись (ЭЦП).

Мы не будем разбирать технические особенности устройства ЭЦП, опишем только принцип работы. У ЭЦП есть два ключа (как и все в компьютере это всего лишь набор байтов), один секретный/приватный, как следует из названия его нельзя сообщать никому, его должен знать только владелец ЭЦП, а второй открытый/публичный, его можно сообщать всем. ЭЦП устроен так что с помощью секретного ключа и только с его помощью можно создать ЭЦП для любого документа (как ЭЦП так и подписываемый документ это всего лишь байты), а с помощью открытого ключа всегда можно проверить достоверность подписи (если изменится хотя бы один бит документа ЭЦП не пройдет проверку).

Открытый ключ в биткоине используется как номер счета. Тогда владелец счета может создать запись вида "счет такой то, на счет такой то, перевести столько то BTC", и подписать данный документ (транзакцию/перевод) своим секретным ключом. Это очень похоже на подписывание чека из чековой книжки, так знакомый нам по американским фильмам, принцип тот же. И разослать эту транзакцию всем участникам. Далее любой кто получит транзакцию, берет счет отравителя он же открытый ключ владельца счета и проверяет ЭЦП, если все верно все понимают что транзакция создана владельцем счета, так как только у него есть секретный ключ, все просто и без раскрытия персональных данных. Согласитесь красиво. Собственно в Биткойне нет как такового счета, есть только подписанные транзакции, а состояние счета это разница между полученными деньгами и потраченными. База биткоина хранит историю всех транзакций, поэтому мы всегда можем посчитать текущее состояние счета. Есть два типа транзакций: это транзакция с переводом между счетами, и вы не можете создавать транзакции тратящие больше чем у вас есть; а второй тип транзакции это эмиссионная с вознаграждением за создание блока, у нее нет отправителя только получатель (но о ней еще поговорим когда дойдем до блокчейна).

И так у нас есть транзакции защищенные ЭЦП и виртуальные счета как разница между приходом и расходом, все вроде бы хорошо, но у нас остается проблема двойной траты. Не что не мешает нам создавать сколько угодно транзакций, а как говорилось интернет не гарантирует что транзакции до всех дойдут с одинаковой скоростью, и так может случиться что несколько участников получат транзакции подтверждающие перевод на их счета, они проверят ЭЦП, убедятся что транзакция не тратит больше чем есть у вас уже на счету и отгрузят товар, а только потом заметят что вы насоздавали еще несколько транзакций превышающие ваш баланс. ЭЦП подтверждает что это ваша транзакция но не защищает от создания копий, эту проблему призвано решить идея блокчейн.

Блокчейн

Нужно как то упорядочить транзакции, тогда как и в централизованной системе будет понятна очередность списания денег со счета и понятно какие транзакции не проходят. Казалось бы можно в транзакции сохранять временную метку, но не что не мешает ее подделать создателю платежа. Решение такое, нужно с какой то периодичностью собирать все новые транзакции в блок (блок это всего лишь запись о порядке транзакций), добавляя проверять подпись и что транзакция не тратит больше чем есть на счету с учетом уже положенных транзакций в блок. Затем через какое то время фиксировать блок и отсылать его всем остальным участникам.
